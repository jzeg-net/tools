let add_new_number=document.querySelector("#add_new_number"),phone_number_submit=document.querySelector("#phone_number_submit"),add_phone_number_form=document.querySelector("#add_phone_number_form"),add_phone_number_url="/tools/phone_number/phonenumber.php",RegExp_rules={chinese_name:new RegExp(/^([\u4e00-\u9fa5·]{2,16})$/),tel_number:new RegExp(/\d{3}-\d{8}|\d{4}-\d{7}/),mobile_number:new RegExp(/^(?:(?:\+|00)86)?1(?:(?:3[\d])|(?:4[5-7|9])|(?:5[0-3|5-9])|(?:6[5-7])|(?:7[0-8])|(?:8[\d])|(?:9[1|8|9]))\d{8}$/),ip_v4:new RegExp(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/),ip_v6:new RegExp(/^((([0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){6}:[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){5}:([0-9A-Fa-f]{1,4}:)?[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){4}:([0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){3}:([0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){2}:([0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){6}((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|(([0-9A-Fa-f]{1,4}:){0,5}:((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|(::([0-9A-Fa-f]{1,4}:){0,5}((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|([0-9A-Fa-f]{1,4}::([0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})|(::([0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){1,7}:))$/i),zh_cn_number:new RegExp(/^((?:[\u3400-\u4DB5\u4E00-\u9FEA\uFA0E\uFA0F\uFA11\uFA13\uFA14\uFA1F\uFA21\uFA23\uFA24\uFA27-\uFA29]|[\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0])|(\d))+$/)};function phone_number_data(){let e=document.querySelectorAll(".phone_name"),t=document.querySelectorAll(".tel_number"),n=document.querySelectorAll(".mobile_number"),r=[];for(let o=e.length,a=0;a<o;a++)r[a]={phone_name:e[a].value,tel_number:t[a].value,mobile_number:n[a].value};return JSON.stringify(r)}function create_form_add_init(){create_form_div(),create_btn_add(),create_phone_name(),create_tel_number(),create_mobile_number()}function create_form_add(){create_form_div(),create_btn_del(),create_phone_name(),create_tel_number(),create_mobile_number()}function create_form_div(){let e=document.createElement("div");e.className="mb-5 mb-sm-4 mb-md-3 form-row add_phone_number_form",add_phone_number_form.insertBefore(e,phone_number_submit.parentElement)}function create_phone_name(){let e=document.createElement("div"),t=document.createElement("label"),n=document.createElement("input"),r=document.createElement("i"),o=(new Date).getTime();e.className="form-group col-12 col-sm-12 col-md-3",t.className="sr-only",t.setAttribute("for","phone_name_"+o),t.innerHTML="单位名称&nbsp;",r.className="fa fa-home",n.className="form-control fa text-success text-center phone_name",n.id="phone_name_"+o,n.type="text",n.setAttribute("minlength","4"),n.setAttribute("maxlength","15"),n.placeholder="单位名称 ",n.addEventListener("input",(function(e){phone_input_check(RegExp_rules.chinese_name,"请输入单位的中文名称 例如：\n掘进一队",e)})),t.appendChild(r),e.appendChild(t),e.appendChild(n),add_phone_number_form.children[add_phone_number_form.childElementCount-2].appendChild(e)}function create_tel_number(){let e=document.createElement("div"),t=document.createElement("label"),n=document.createElement("input"),r=document.createElement("i"),o=(new Date).getTime();e.className="form-group col-12 col-sm-6 col-md-4",t.className="sr-only",t.setAttribute("for","tel_number_"+o),t.innerHTML="座机电话号码&nbsp;",r.className="fa fa-phone",n.className="form-control fa text-success text-center tel_number",n.id="tel_number_"+o,n.type="tel",n.setAttribute("minlength","12"),n.setAttribute("maxlength","12"),n.placeholder="座机电话号码 ",n.addEventListener("input",(function(e){phone_input_check(RegExp_rules.tel_number,"请输入正确格式的座机号码 例如：\n0319-1234567",e)})),t.appendChild(r),e.appendChild(t),e.appendChild(n),add_phone_number_form.children[add_phone_number_form.childElementCount-2].appendChild(e)}function create_mobile_number(){let e=document.createElement("div"),t=document.createElement("label"),n=document.createElement("input"),r=document.createElement("i"),o=(new Date).getTime();e.className="form-group col-12 col-sm-6 col-md-5",t.className="sr-only",t.setAttribute("for","mobile_number_"+o),t.innerHTML="手机电话号码&nbsp;",r.className="fa fa-mobile-alt",n.className="form-control fa text-success text-center mobile_number",n.id="mobile_number_"+o,n.type="tel",n.setAttribute("minlength","11"),n.setAttribute("maxlength","15"),n.placeholder="手机电话号码 ",n.addEventListener("input",(function(e){phone_input_check(RegExp_rules.mobile_number,"请输入正确格式的手机号 例如：\n13812345678\n+8613812345678\n008613812345678",e)})),t.appendChild(r),e.appendChild(t),e.appendChild(n),add_phone_number_form.children[add_phone_number_form.childElementCount-2].appendChild(e)}function create_btn_add(){let e=document.createElement("a"),t=document.createElement("i");e.className="position-relative text-success",e.href="javascript:",e.title="添加新的一行",e.id="phone_number_add",t.className="position-absolute fa fa-plus-circle phone_number_del",t.style.top="11px",t.style.right="0px",e.appendChild(t),add_phone_number_form.children[add_phone_number_form.childElementCount-2].appendChild(e),e.addEventListener("click",create_form_add)}function create_btn_del(){let e=document.createElement("a"),t=document.createElement("i");e.className="position-relative text-danger",e.href="javascript:",e.title="删除当前行",t.className="position-absolute fa fa-minus-circle phone_number_del",t.style.top="11px",t.style.right="0px",e.appendChild(t),add_phone_number_form.children[add_phone_number_form.childElementCount-2].appendChild(e),e.addEventListener("click",(function(e){e.target.parentElement.parentElement.parentElement.removeChild(e.target.parentElement.parentElement)}))}function phone_input_check(e,t,n){e.test(n.target.value)?(input_success(n),remove_validation_div(n)):(validation_invalid_div(n,t),input_error(n))}function validation_invalid_div(e,t,n="tooltip"){let r=e.target;if(!r.nextElementSibling){let e=document.createElement("div");"tooltip"===n?(e.className="invalid-tooltip",e.style.position="unset"):e.className="invalid-feedback",e.innerText=t,r.parentNode.appendChild(e)}}function validation_valid_div(e,t,n="tooltip"){let r=e.target;if(!r.nextElementSibling){let e=document.createElement("div");"tooltip"===n?(e.className="valid-tooltip",e.style.position="unset"):e.className="valid-feedback",e.innerText=t,r.parentNode.appendChild(e)}}function remove_validation_div(e){let t=e.target;for(;t.nextElementSibling;)t.nextElementSibling.remove()}function input_error(e){let t=e.target;t.classList.remove("is-valid"),t.classList.add("is-invalid")}function input_success(e){let t=e.target;t.classList.remove("is-invalid"),t.classList.add("is-valid")}function add_spinner_icon(e,t="border"){let n=document.createElement("span");switch(t){case"grow":n.className="ml-1 spinner-grow spinner-grow-sm";break;case"border":default:n.className="ml-1 spinner-border spinner-border-sm"}e.setAttribute("disabled","disabled"),e.appendChild(n)}function remove_spinner_icon(e){e.removeAttribute("disabled"),e.removeChild(e.lastChild)}function add_phone_number(){let e=phone_number_data();$.ajax({type:"post",url:add_phone_number_url,dataType:"json",timeout:5e3,beforeSend:add_spinner_icon(phone_number_submit),complete:remove_spinner_icon(phone_number_submit),data:{data:e},success:function(e){let t=e.result;t&&bootstrapModalJs("",t,"","",!0),console.log(e)},error:function(e){"timeout"===e.statusText?bootstrapModalJs("","连接服务器超时，请尝试重新提交。","","",!0):"OK"===e.statusText&&""!==e.responseText?bootstrapModalJs("",e.responseText,"","",!0):(bootstrapModalJs("","失败","","",!0),console.log(e))}})}add_new_number&&add_new_number.addEventListener("click",(function(e){create_form_add_init(),e.target.parentNode.removeChild(e.target),add_phone_number_form.classList.remove("d-none"),add_phone_number_form.classList.toggle("show")})),phone_number_submit&&phone_number_submit.addEventListener("click",add_phone_number);let phone_number_input=document.querySelector("#phone_number_input"),phone_name_search_btn=document.querySelector("#phone_name_search_btn"),phone_number_search_btn=document.querySelector("#phone_number_search_btn"),number_list=document.querySelector("#number_list"),search_url="/tools/phone_number/phone_number_search.php";function check_search_value(){let e=phone_number_input.value,t=RegExp_rules.zh_cn_number.test(e);0===e.length?bootstrapModalJs("","请输入您要查询的单位名称或号码","","",!0):t||bootstrapModalJs("","请输入单独的单位名称或者号码","","",!0),console.log(phone_number_input.value)}function search_query(e="name"){ajax_search({search_type:e,search_value:phone_number_input.value})}function ajax_search(e){$.ajax({type:"post",url:search_url,data:e,dataType:"json",success:function(e){console.log("成功"),get_search_result(e),console.log(e)},error:function(e){let t=e.responseText;console.log("失败"),console.log(e),console.log(t)}})}function get_search_result(e){e.length?processing_search_result(e):bootstrapModalJs("","暂时没有找到您要查找的号码","","",!0)}function processing_search_result(e){let t;for(t in number_list.innerHTML="",e)create_number_list(e[t]);number_list_child()}function create_number_list(e){let t=document.createElement("div"),n=e.phone_name,r=e.tel_number,o=e.mobile_number;t.className="mb-3 py-1 py-md-2 row  border rounded align-items-center number_list",t.appendChild(create_number_list_name(n)),t.appendChild(create_number_list_number(r,"tel")),t.appendChild(create_number_list_number(o,"mobile")),number_list.appendChild(t)}function create_number_list_name(e){let t=document.createElement("span"),n=document.createElement("ul"),r=document.createElement("li"),o=document.createElement("i");return t.className="col-12 col-lg-4",n.className="mb-0 list-unstyled",r.className="mb-2",r.innerHTML=e,o.className="mr-2 fa fa-home text-info",o.style.cursor="pointer",t.appendChild(n),n.appendChild(r),r.insertBefore(o,r.firstChild),t}function create_number_list_number(e,t){let n=document.createElement("span"),r=document.createElement("ul"),o=document.createElement("li"),a=document.createElement("i");return n.className="col-12 col-sm-5 col-md-4 col-lg-3",r.className="mb-0 list-unstyled",o.className="tel"===t?"mb-2":"mb-2 text-none text-sm-right",o.innerHTML=e,a.className="tel"===t?"ml-2 fa fa-phone-alt text-success":"ml-2 fa fa-mobile-alt text-success",a.style.cursor="pointer",a.addEventListener("click",(function(t){window.location.href="tel://"+e})),n.appendChild(r),r.appendChild(o),o.appendChild(a),n}function number_list_child(){let e=document.querySelectorAll("#number_list div:nth-child(odd)"),t=document.querySelectorAll("#number_list div:nth-child(even)");for(let t=e.length,n=0;n<t;n++)e[n].style.background="whitesmoke";for(let e=t.length,n=0;n<e;n++)t[n].style.background="aliceblue"}phone_name_search_btn&&phone_name_search_btn.addEventListener("click",(function(){check_search_value(),search_query("name")})),phone_number_search_btn&&phone_number_search_btn.addEventListener("click",(function(){check_search_value(),search_query("number")}));let btn_all=document.querySelectorAll("[class*='btn']"),input_all=document.querySelectorAll("input[class*='form-control']");for(let e=btn_all.length,t=0;t<e;t++)btn_all[t].addEventListener("mouseover",shadow),btn_all[t].addEventListener("mouseout",shadow);for(let e=input_all.length,t=0;t<e;t++)input_all[t].addEventListener("focusin",shadow_sm),input_all[t].addEventListener("focusout",shadow_sm);function shadow(e){e.target.classList.toggle("shadow")}function shadow_sm(e){e.target.classList.toggle("shadow-sm")}function shadow_lg(e){e.target.classList.toggle("shadow-lg")}function topControl(e){e.preventDefault(),$("html,body").animate({scrollTop:"0px"},1e3)}!function(){let e=document.querySelector("#to_top");e&&e.addEventListener("click",topControl)}();let number_stored=document.querySelector("#number_stored");function get_number_stored(){$.ajax({type:"post",url:"/tools/phone_number/number_stored.php",dataType:"json",timeout:3e3,data:{number_stored:""},beforeSend:function(){number_stored.innerHTML="正在获取数据"},success:function(e){number_stored.innerHTML="当前号码存储数量"+e+"条"},error:function(e){number_stored.innerHTML=e.responseText}})}number_stored&&number_stored.addEventListener("click",get_number_stored),phone_number_submit&&phone_number_submit.addEventListener("click",get_number_stored);